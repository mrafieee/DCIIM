var DateTimeShortcuts={calendars:[],calendarInputs:[],clockInputs:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",admin_media_prefix:"",init:function(){if(window.__admin_media_prefix__!=undefined){DateTimeShortcuts.admin_media_prefix=window.__admin_media_prefix__}else{DateTimeShortcuts.admin_media_prefix="/missing-admin-media-prefix/"}var a=document.getElementsByTagName("input");for(i=0;i<a.length;i++){var b=a[i];if(b.getAttribute("type")=="text"&&b.className.match(/vTimeField/)){DateTimeShortcuts.addClock(b)}else{if(b.getAttribute("type")=="text"&&b.className.match(/vDateField/)){DateTimeShortcuts.addCalendar(b)}}}},addClock:function(h){var e=DateTimeShortcuts.clockInputs.length;DateTimeShortcuts.clockInputs[e]=h;var g=document.createElement("span");g.className=DateTimeShortcuts.shortCutsClass;h.parentNode.insertBefore(g,h.nextSibling);var d=document.createElement("a");d.setAttribute("href","javascript:DateTimeShortcuts.handleClockQuicklink("+e+", new Date().strftime('"+get_format("TIME_INPUT_FORMATS")[0]+"'));");d.appendChild(document.createTextNode(gettext("Now")));var f=document.createElement("a");f.setAttribute("href","javascript:DateTimeShortcuts.openClock("+e+");");f.id=DateTimeShortcuts.clockLinkName+e;quickElement("img",f,"","src",DateTimeShortcuts.admin_media_prefix+"img/icon_clock.gif","alt",gettext("Clock"));g.appendChild(document.createTextNode("\240"));g.appendChild(d);g.appendChild(document.createTextNode("\240|\240"));g.appendChild(f);var c=document.createElement("div");c.style.display="none";c.style.position="absolute";c.className="clockbox module";c.setAttribute("id",DateTimeShortcuts.clockDivName+e);document.body.appendChild(c);addEvent(c,"click",DateTimeShortcuts.cancelEventPropagation);quickElement("h2",c,gettext("Choose a time"));var j=quickElement("ul",c,"");j.className="timelist";var b=get_format("TIME_INPUT_FORMATS")[0];quickElement("a",quickElement("li",j,""),gettext("Now"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+e+", new Date().strftime('"+b+"'));");quickElement("a",quickElement("li",j,""),gettext("Midnight"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+e+", new Date(1970,1,1,0,0,0,0).strftime('"+b+"'));");quickElement("a",quickElement("li",j,""),gettext("6 a.m."),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+e+", new Date(1970,1,1,6,0,0,0).strftime('"+b+"'));");quickElement("a",quickElement("li",j,""),gettext("Noon"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+e+", new Date(1970,1,1,12,0,0,0).strftime('"+b+"'));");var a=quickElement("p",c,"");a.className="calendar-cancel";quickElement("a",a,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissClock("+e+");");django.jQuery(document).bind("keyup",function(k){if(k.which==27){DateTimeShortcuts.dismissClock(e);k.preventDefault()}})},openClock:function(b){var c=document.getElementById(DateTimeShortcuts.clockDivName+b);var a=document.getElementById(DateTimeShortcuts.clockLinkName+b);if(getStyle(document.body,"direction")!="rtl"){c.style.left=findPosX(a)+17+"px"}else{c.style.left=findPosX(a)-110+"px"}c.style.top=Math.max(0,findPosY(a)-30)+"px";c.style.display="block";addEvent(window.document,"click",function(){DateTimeShortcuts.dismissClock(b);return true})},dismissClock:function(a){document.getElementById(DateTimeShortcuts.clockDivName+a).style.display="none";window.document.onclick=null},handleClockQuicklink:function(a,b){DateTimeShortcuts.clockInputs[a].value=b;DateTimeShortcuts.clockInputs[a].focus();DateTimeShortcuts.dismissClock(a)},addCalendar:function(g){var d=DateTimeShortcuts.calendars.length;DateTimeShortcuts.calendarInputs[d]=g;var f=document.createElement("span");f.className=DateTimeShortcuts.shortCutsClass;g.parentNode.insertBefore(f,g.nextSibling);var k=document.createElement("a");k.setAttribute("href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", 0);");k.appendChild(document.createTextNode(gettext("Today")));var b=document.createElement("a");b.setAttribute("href","javascript:DateTimeShortcuts.openCalendar("+d+");");b.id=DateTimeShortcuts.calendarLinkName+d;quickElement("img",b,"","src",DateTimeShortcuts.admin_media_prefix+"img/icon_calendar.gif","alt",gettext("Calendar"));f.appendChild(document.createTextNode("\240"));f.appendChild(k);f.appendChild(document.createTextNode("\240|\240"));f.appendChild(b);var j=document.createElement("div");j.style.display="none";j.style.position="absolute";j.className="calendarbox module";j.setAttribute("id",DateTimeShortcuts.calendarDivName1+d);document.body.appendChild(j);addEvent(j,"click",DateTimeShortcuts.cancelEventPropagation);var c=quickElement("div",j,"");var h=quickElement("a",c,"<","href","javascript:DateTimeShortcuts.drawPrev("+d+");");h.className="calendarnav-previous";var l=quickElement("a",c,">","href","javascript:DateTimeShortcuts.drawNext("+d+");");l.className="calendarnav-next";var m=quickElement("div",j,"","id",DateTimeShortcuts.calendarDivName2+d);m.className="calendar";DateTimeShortcuts.calendars[d]=new Calendar(DateTimeShortcuts.calendarDivName2+d,DateTimeShortcuts.handleCalendarCallback(d));DateTimeShortcuts.calendars[d].drawCurrent();var e=quickElement("div",j,"");e.className="calendar-shortcuts";quickElement("a",e,gettext("Yesterday"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", -1);");e.appendChild(document.createTextNode("\240|\240"));quickElement("a",e,gettext("Today"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", 0);");e.appendChild(document.createTextNode("\240|\240"));quickElement("a",e,gettext("Tomorrow"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", +1);");var a=quickElement("p",j,"");a.className="calendar-cancel";quickElement("a",a,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissCalendar("+d+");");django.jQuery(document).bind("keyup",function(n){if(n.which==27){DateTimeShortcuts.dismissCalendar(d);n.preventDefault()}})},openCalendar:function(b){var c=document.getElementById(DateTimeShortcuts.calendarDivName1+b);var a=document.getElementById(DateTimeShortcuts.calendarLinkName+b);var e=DateTimeShortcuts.calendarInputs[b];if(e.value){var f=e.value.split("-");var d=f[0];var g=parseFloat(f[1]);if(d.match(/\d\d\d\d/)&&g>=1&&g<=12){DateTimeShortcuts.calendars[b].drawDate(g,d)}}if(getStyle(document.body,"direction")!="rtl"){c.style.left=findPosX(a)+17+"px"}else{c.style.left=findPosX(a)-180+"px"}c.style.top=Math.max(0,findPosY(a)-75)+"px";c.style.display="block";addEvent(window.document,"click",function(){DateTimeShortcuts.dismissCalendar(b);return true})},dismissCalendar:function(a){document.getElementById(DateTimeShortcuts.calendarDivName1+a).style.display="none";window.document.onclick=null},drawPrev:function(a){DateTimeShortcuts.calendars[a].drawPreviousMonth()},drawNext:function(a){DateTimeShortcuts.calendars[a].drawNextMonth()},handleCalendarCallback:function(a){format=get_format("DATE_INPUT_FORMATS")[0];format=format.replace("\\","\\\\");format=format.replace("\r","\\r");format=format.replace("\n","\\n");format=format.replace("\t","\\t");format=format.replace("'","\\'");return["function(y, m, d) { DateTimeShortcuts.calendarInputs[",a,"].value = new Date(y, m-1, d).strftime('",format,"');DateTimeShortcuts.calendarInputs[",a,"].focus();document.getElementById(DateTimeShortcuts.calendarDivName1+",a,").style.display='none';}"].join("")},handleCalendarQuickLink:function(a,c){var b=new Date();b.setDate(b.getDate()+c);DateTimeShortcuts.calendarInputs[a].value=b.strftime(get_format("DATE_INPUT_FORMATS")[0]);DateTimeShortcuts.calendarInputs[a].focus();DateTimeShortcuts.dismissCalendar(a)},cancelEventPropagation:function(a){if(!a){a=window.event}a.cancelBubble=true;if(a.stopPropagation){a.stopPropagation()}}};addEvent(window,"load",DateTimeShortcuts.init);