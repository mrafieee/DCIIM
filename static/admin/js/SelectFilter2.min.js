(function(b){function a(c){if(c.tagName.toLowerCase()!="form"){return a(c.parentNode)}return c}window.SelectFilter={init:function(g,c,p,y){if(g.match(/__prefix__/)){return}var d=document.getElementById(g);d.id+="_from";d.className="filtered";var v=d.parentNode.getElementsByTagName("p");for(var x=0;x<v.length;x++){if(v[x].className.indexOf("info")!=-1){d.parentNode.removeChild(v[x])}else{if(v[x].className.indexOf("help")!=-1){d.parentNode.insertBefore(v[x],d.parentNode.firstChild)}}}var n=quickElement("div",d.parentNode);n.className=p?"selector stacked":"selector";var u=quickElement("div",n,"");u.className="selector-available";var l=quickElement("h2",u,interpolate(gettext("Available %s")+" ",[c]));quickElement("img",l,"","src",y+"img/icon-unknown.gif","width","10","height","10","class","help help-tooltip","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[c]));var e=quickElement("p",u,"","id",g+"_filter");e.className="selector-filter";var h=quickElement("label",e,"","for",g+"_input");var B=quickElement("img",h,"","src",y+"img/selector-search.gif","class","help-tooltip","alt","","title",interpolate(gettext("Type into this box to filter down the list of available %s."),[c]));e.appendChild(document.createTextNode(" "));var k=quickElement("input",e,"","type","text","placeholder",gettext("Filter"));k.id=g+"_input";u.appendChild(d);var m=quickElement("a",u,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[c]),"href",'javascript: (function(){ SelectBox.move_all("'+g+'_from", "'+g+'_to"); SelectFilter.refresh_icons("'+g+'");})()',"id",g+"_add_all_link");m.className="selector-chooseall";var o=quickElement("ul",n,"");o.className="selector-chooser";var t=quickElement("a",quickElement("li",o,""),gettext("Choose"),"title",gettext("Choose"),"href",'javascript: (function(){ SelectBox.move("'+g+'_from","'+g+'_to"); SelectFilter.refresh_icons("'+g+'");})()',"id",g+"_add_link");t.className="selector-add";var w=quickElement("a",quickElement("li",o,""),gettext("Remove"),"title",gettext("Remove"),"href",'javascript: (function(){ SelectBox.move("'+g+'_to","'+g+'_from"); SelectFilter.refresh_icons("'+g+'");})()',"id",g+"_remove_link");w.className="selector-remove";var r=quickElement("div",n,"");r.className="selector-chosen";var f=quickElement("h2",r,interpolate(gettext("Chosen %s")+" ",[c]));quickElement("img",f,"","src",y+"img/icon-unknown.gif","width","10","height","10","class","help help-tooltip","title",interpolate(gettext('This is the list of chosen %s. You may remove some by selecting them in the box below and then clicking the "Remove" arrow between the two boxes.'),[c]));var j=quickElement("select",r,"","id",g+"_to","multiple","multiple","size",d.size,"name",d.getAttribute("name"));j.className="filtered";var A=quickElement("a",r,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[c]),"href",'javascript: (function() { SelectBox.move_all("'+g+'_to", "'+g+'_from"); SelectFilter.refresh_icons("'+g+'");})()',"id",g+"_remove_all_link");A.className="selector-clearall";d.setAttribute("name",d.getAttribute("name")+"_old");addEvent(k,"keyup",function(i){SelectFilter.filter_key_up(i,g)});addEvent(k,"keydown",function(i){SelectFilter.filter_key_down(i,g)});addEvent(d,"change",function(i){SelectFilter.refresh_icons(g)});addEvent(j,"change",function(i){SelectFilter.refresh_icons(g)});addEvent(d,"dblclick",function(){SelectBox.move(g+"_from",g+"_to");SelectFilter.refresh_icons(g)});addEvent(j,"dblclick",function(){SelectBox.move(g+"_to",g+"_from");SelectFilter.refresh_icons(g)});addEvent(a(d),"submit",function(){SelectBox.select_all(g+"_to")});SelectBox.init(g+"_from");SelectBox.init(g+"_to");SelectBox.move(g+"_from",g+"_to");if(!p){var q=b(d);var s=b(j);var z=function(){s.height(b(e).outerHeight()+q.outerHeight())};if(q.outerHeight()>0){z()}else{s.closest("fieldset").one("show.fieldset",z)}}SelectFilter.refresh_icons(g)},refresh_icons:function(d){var g=b("#"+d+"_from");var f=b("#"+d+"_to");var e=g.find("option:selected").length>0;var c=f.find("option:selected").length>0;b("#"+d+"_add_link").toggleClass("active",e);b("#"+d+"_remove_link").toggleClass("active",c);b("#"+d+"_add_all_link").toggleClass("active",g.find("option").length>0);b("#"+d+"_remove_all_link").toggleClass("active",f.find("option").length>0)},filter_key_up:function(e,d){var f=document.getElementById(d+"_from");if((e.which&&e.which==13)||(e.keyCode&&e.keyCode==13)){f.selectedIndex=0;SelectBox.move(d+"_from",d+"_to");f.selectedIndex=0;return false}var c=f.selectedIndex;SelectBox.filter(d+"_from",document.getElementById(d+"_input").value);f.selectedIndex=c;return true},filter_key_down:function(d,c){var f=document.getElementById(c+"_from");if((d.which&&d.which==39)||(d.keyCode&&d.keyCode==39)){var e=f.selectedIndex;SelectBox.move(c+"_from",c+"_to");f.selectedIndex=(e==f.length)?f.length-1:e;return false}if((d.which&&d.which==40)||(d.keyCode&&d.keyCode==40)){f.selectedIndex=(f.length==f.selectedIndex+1)?0:f.selectedIndex+1}if((d.which&&d.which==38)||(d.keyCode&&d.keyCode==38)){f.selectedIndex=(f.selectedIndex==0)?f.length-1:f.selectedIndex-1}return true}}})(django.jQuery);